# MySQL

Цель домашнего задания:

Настроить репликацию MySQL

Описание домашнего задания:

Развернуть базу данных на мастере, и реплицировать на слейв таблицы bookmaker, competition, market, odds, outcome. Репликация должна выполняться с помощью GTID

Выполнение домашнего задания:

- Поднимаем две виртуальные машины - master и slave. Master - основная БД, slave - реплика с master'а:

`vagrant up`

- Устанавливаем на обе машины Percona Server for MySQL 5.7

image1

- Те же действия повторяем на slave.

По умолчанию Percona хранит файлы в таком виде:

1 основной конфиг в /etc/my.cnf

2 так же инклюдится директория /etc/my.cnf.d/ - куда мы и будем складывать наши конфиги.

3 data файлы в /var/lib/mysql

- Копируем заранее подготовленные конфиги:

`cp /vagrant/conf.d/* /etc/my.cnf.d/`

- Запускаем службу MySQL:

image2

- Те же действия выполняем на slave.

- При установке Percona автоматически генерирует пароль для пользователя root и кладет его в файл /var/log/mysqld.log:

image3

- Меняем пароль:

image4

- Репликацию будем настраивать с использованием GTID. GTID представляет собой уникальный 128-битный глобальный идентификационный номер (SERVER_UUID), который увеличивается с каждой новой транзакцией.

- Следует обратить внимание, что атрибут server-id на мастер-сервере должен обязательно отличаться от server-id слейв-сервера. Проверить какая переменная установлена на текущий момент можно следующим образом:

image5

- Параметр server-id у нас прописан в конфигурационном файле etc/my.cnf.d/01-base.cnf. Соответственно на slave его нужно изменить и перезагрузить mysql.

- Убеждаемся что GTID включён:

image6

- Создадим тестовую базу bet на master'е, загрузим в нее дамп и проверим:

image7

- Создадим пользователя для репликации и дадим ему права на эту самую репликацию:

image8

Дампим базу для последующего залива на slave и игнорируем таблицы по заданию:

